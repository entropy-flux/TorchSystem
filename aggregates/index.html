<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Aggregates - mlregistry</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Aggregates";
        var mkdocs_page_input_path = "aggregates.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> mlregistry
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Aggregates</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../compiler/">Compiler</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../storage/">Storage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../repository/">Repository</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">mlregistry</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Aggregates</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h3 id="implement-deep-learning-aggregates-with-pytorch">Implement deep learning Aggregates with PyTorch</h3>


<div class="doc doc-object doc-module">



<a id="torchsystem.aggregate"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="torchsystem.aggregate.Aggregate" class="doc doc-heading">
            <code>Aggregate</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code>, <code><span title="abc.ABC">ABC</span></code></p>


        <p>An AGGREGATE is a cluster of associated objects that we treat as a unit for the purpose
of data changes. Each AGGREGATE has a root and a boundary. The boundary defines what is
inside the AGGREGATE. The root is a single, specific ENTITY contained in the AGGREGATE.</p>
<p>An AGGREGATE is responsible for maintaining the consistency of the data within its boundary
and enforcing invariants that apply to the AGGREGATE as a whole. It can communicate data
to the outside world and execute complex logic using domain events or messages through in 
memory message patterns.</p>
<p>In deep learning, an AGGREGATE consist not only of a neural network, but also several other
components such as optimizers, schedulers, tokenizers, etc. In order to perform complex tasks.</p>
<p>For example, a transformer model is just a neural network, and in order to perform tasks such
as text completion or translation, it needs to be part of an AGGREGATE that includes other 
components like a tokenizer. The AGGREGATE is responsible for coordinating the interactions <br />
between these components.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Attributes:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>id</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>The id of the AGGREGATE ROOT. It should be unique within the AGGREGATE boundary.</p>
              </div>
            </li>
            <li>
              <b><code>phase</code></b>
                  (<code><span title="typing.Literal">Literal</span>[&#39;train&#39;, &#39;evaluation&#39;]</code>)
              –
              <div class="doc-md-description">
                <p>The phase of the AGGREGATE.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><span title="torchsystem.aggregate.Aggregate.emit">emit</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Emits an event to all consumers of the AGGREGATE.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="torchsystem.aggregate.Aggregate.register" href="#torchsystem.aggregate.Aggregate.register">register</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Bind a group of consumers to the AGGREGATEs producer.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>
        <p>Example:</p>
<pre><code>.. code-block:: python

from torch import Tensor
from torch.nn import Module
from torch.optim import Optimizer
from torchsystem import Aggregate

class Classifier(Aggregate):
    def __init__(self, model: Module, criterion: Module, optimizer: Optimizer):
        super().__init__()
        self.epoch = 0
        self.model = model
        self.criterion = criterion
        self.optimizer = optimizer

    def forward(self, input: Tensor) -&gt; Tensor:
        return self.model(input)

    def loss(self, output: Tensor, target: Tensor) -&gt; Tensor:
        return self.criterion(output, target)

    def fit(self, input: Tensor, target: Tensor) -&gt; tuple[Tensor, float]:
        self.optimizer.zero_grad()
        output = self(input)
        loss = self.loss(output, target)
        loss.backward()
        self.optimizer.step()
        return output, loss.item()

    def evaluate(self, input: Tensor, target: Tensor) -&gt; tuple[Tensor, float]: 
        output = self(input)
        loss = self.loss(output, target)
        return output, loss.item()
</code></pre>









  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="torchsystem.aggregate.Aggregate.epoch" class="doc doc-heading">
            <code class="highlight language-python">epoch</code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The current epoch of the AGGREGATE. The epoch is a property on a machine learning aggregate
and it's determined by the epoch of it's AGGREGATE ROOT. Secondary effects can be triggered
by the epoch change overriding the <code>onepoch</code> method.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>int</code></b>(                  <code>int</code>
)              –
              <div class="doc-md-description">
                <p>The current epoch.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="torchsystem.aggregate.Aggregate.id" class="doc doc-heading">
            <code class="highlight language-python">id</code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The id of the AGGREGATE ROOT. It should be unique within the AGGREGATE boundary.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="torchsystem.aggregate.Aggregate.phase" class="doc doc-heading">
            <code class="highlight language-python">phase</code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The phase of the AGGREGATE. The phase is a property of neural networks that not only describes
the current state of the network, but also determines how the network should behave. During the
training phase, the network stores the gradients of the weights and biases, and uses them to update
the weights and biases. During the evaluation phase, the network does not store the gradients of the
weights and biases, and does not update the weights and biases.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Literal">Literal</span>[&#39;train&#39;, &#39;evaluation&#39;]</code>
              –
              <div class="doc-md-description">
                <p>Literal['train', 'evaluation']: The current phase of the AGGREGATE.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="torchsystem.aggregate.Aggregate.onepoch" class="doc doc-heading">
            <code class="highlight language-python">onepoch()</code>

</h3>


    <div class="doc doc-contents ">

        <p>A hook that is called when the epoch changes. Implement this method to add custom behavior.</p>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchsystem.aggregate.Aggregate.onphase" class="doc doc-heading">
            <code class="highlight language-python">onphase()</code>

</h3>


    <div class="doc doc-contents ">

        <p>A hook that is called when the phase changes. Implement this method to add custom behavior.</p>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchsystem.aggregate.Aggregate.publish" class="doc doc-heading">
            <code class="highlight language-python">publish(message, topic)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Publish a message to all subscribers of a given topic.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>message</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>The message to publish.</p>
              </div>
            </li>
            <li>
              <b><code>topic</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The topic to publish the message.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchsystem.aggregate.Aggregate.register" class="doc doc-heading">
            <code class="highlight language-python">register(*observers)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Bind a group of observers to the AGGREGATE. Each observer will consumer EVENTS
from the AGGREGATE. You can register an observer from here or you can observe this
AGGREGATE from an observer since observers also implement the logic registration logic.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>consumers</code></b>
                  (<code><span title="pymsgbus.consumers.Consumer">Consumer</span></code>)
              –
              <div class="doc-md-description">
                <p>The consumers to bind.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../compiler/" class="btn btn-neutral float-right" title="Compiler">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../compiler/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
